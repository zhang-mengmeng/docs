---
outline: deep
prev:
  text: 'http响应头和请求头'
  link: '/http.md'
next:
  text: 'SEO(搜索引擎优化)'
  link: '/seo.md'
---

# HTTP 缓存概述：强缓存与协商缓存

HTTP 缓存（HTTP Caching）是一种提高网页加载速度、减少服务器负载和提高用户体验的技术。它通过在客户端或代理服务器上存储 HTTP 响应，以便在后续请求中直接使用缓存数据，而无需再次从原始服务器获取内容。

## 1. HTTP 缓存的主要类型
- **`浏览器缓存（客户端缓存）`** : 浏览器在本地存储网页资源，如图片、HTML、CSS、JavaScript 等，以减少重复请求和提高加载速度。
- **`代理缓存`** : 代理服务器会缓存多个用户的请求和响应，用于减少对原始服务器的访问频率，常见于企业和 ISP 使用的中间缓存。
- **`网关缓存`** : 应用于反向代理服务器和 CDN（内容分发网络），帮助提高网站的可扩展性和性能。

## 2. 常见的缓存控制机制
 - **HTTP头字段**
   - `Cache-Control`：用于定义缓存策略，如 `public`, `private`, `no-store`, `no-cache`, `max-age` 等。
   - `Expires`：指定缓存过期的具体时间点，常被 `Cache-Control: max-age` 替代。。
   - `ETag`：一种资源的标识符，用于比较资源是否被修改。
   - `Last-Modified`：指示资源的最后修改时间，配合 `If-Modified-Since` 请求头用于条件请求。

 - **缓存策略**
   - `强缓存`：在有效期内直接从缓存中读取，不与服务器通信。使用 `Cache-Control: max-age` 或 `Expires` 实现。
   - `协商缓存`：缓存过期后，通过 `ETag` 或 `Last-Modified` 检查资源是否更新。如果没有更新，返回状态码 `304 Not Modified` 并继续使用缓存内容。

## 3. HTTP 缓存工作流程
- **首次请求** : 浏览器或代理向服务器发出请求并获取资源，同时缓存资源及其相关头信息。
- **后续请求** :
  - 若缓存有效且未过期，使用缓存内容，避免与服务器通信（强缓存）。
  - 若缓存已过期，发出请求验证资源是否有更新（协商缓存）。如果未更新，返回 304 状态码，并使用缓存内容。

## 4. 优化缓存策略的好处

- **减少服务器负载** : 通过缓存减少了请求次数。
- **加快页面加载** : 用户访问已缓存的资源时，加载速度显著提高。
- **节省带宽** : 减少服务器与客户端之间的数据传输量。

## 5. 强缓存（Fresh Cache）
**强缓存**指在缓存有效期内，客户端直接使用缓存数据，不会与服务器通信。

### 实现方式
- **`Cache-Control: max-age=seconds`**
- **`Expires`**

### 示例代码
```http
// 响应头示例
Cache-Control: max-age=3600
Expires: Wed, 22 Nov 2024 08:00:00 GMT
```

### 特点
- **不发起请求**：缓存有效期内直接使用缓存资源。
- **状态码**：`200 (from cache)`

## 6. 协商缓存（Conditional Request）
**协商缓存**指缓存过期后，客户端向服务器验证资源是否更新，若未更新，返回 `304 Not Modified` 状态码。

### 实现方式
- **`ETag`** 与 `If-None-Match`
- **`Last-Modified`** 与 `If-Modified-Since`

### 示例代码
```http
// 响应头示例
ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"
Last-Modified: Wed, 22 Nov 2023 08:00:00 GMT

// 请求头示例
If-None-Match: "33a64df551425fcc55e4d42a148795d9f25f89d4"
If-Modified-Since: Wed, 22 Nov 2023 08:00:00 GMT
```

### 特点
- **发起请求**：缓存过期时与服务器通信验证资源。
- **状态码**：`304 Not Modified` 表示缓存可用，`200 OK` 表示返回新内容。

## 7. 强缓存与协商缓存对比
- **强缓存**：避免网络请求，提高加载速度。
- **协商缓存**：确保获取最新资源。

通常情况下，浏览器会优先使用强缓存。当强缓存失效时，转为协商缓存进行验证。
